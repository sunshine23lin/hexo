---
title: 平衡二叉搜索树
date: 2020-12-12 11:36:28
categories: 数据结构与算法
tags: 数据结构与算法
---

##   平衡二叉搜索树

平衡二叉搜索树简称:**BBST**

**平衡二叉搜索树类型**

- **AVL树**

  Windows NT 内核中广泛使用

- **红黑树**

  C++ STL(比如map、set)

  java的TreeMap、TreeSet、HashMap、HashSet

  Linux的进程调度

  Ngix的timer管理

##  AVL树

**平衡因子(Balance Factor): 某节点的左右子树的高度差**

###  特点

- 每个节点的平衡因子只可能是1、0、-1(如果绝对值-1,如果超过1,称为失衡)
- 每个节点的左右子树高度差不超过1
- 搜索、添加、删除的时间复杂度是o(logn)

![image-20201212141626132](https://jameslin23.gitee.io/2020/12/12/平衡二叉搜索树/image-20201212141626132.png)

 ### 旋转

调整旋转有4种情况

####  LL-右旋转(单旋)

当左子树出现不平衡情况，也就是LL(左节点-左节点)，就需要右旋转

- g.left = p.right
- p.right = g
- 让P成为这个棵子树的根节点
- 仍然是一颗二叉搜索树: T0< n < T1 < p < T2 < g < T3

需要注意的维护内容

- T2、p、g的parent属性
- 先后更新g、p的高度

![image-20201212142308077](https://jameslin23.gitee.io/2020/12/12/平衡二叉搜索树/image-20201212142308077.png)



####  RR - 左旋转(单旋)

当右子树出现不平衡情况，也就是RR(右节点-右节点)，就需要左旋转

- g.right = p.leftt
- p.left = g
- 让p成为这棵子树的根节点
- 仍然是一颗二叉搜索树: T0 < g < T1 < p < T2 <  n <T3

需要维护内容

- T1、p、g的parent属性
- 先后更新g、p的高度

![image-20201212142837427](https://jameslin23.gitee.io/2020/12/12/平衡二叉搜索树/image-20201212142837427.png)



####  LR-左旋转，右旋转

出现LR情况、需要2次旋转，才能达到平衡

![image-20201212143323528](https://jameslin23.gitee.io/2020/12/12/平衡二叉搜索树/image-20201212143323528.png)

####  RL-右旋转,左旋转

![image-20201212143422067](https://jameslin23.gitee.io/2020/12/12/平衡二叉搜索树/image-20201212143422067.png)

###  总结

**添加**

- 可能导致所有祖先节点都失衡
- 只要让高度最低的失衡节点恢复平衡,整棵树就恢复平衡[仅需o(1)次调整]

**删除**

- 只可能会导致父节点失衡
- 让父节点恢复平衡后,可能会导致更高层的祖先节点失衡[最多需要o(logn)次调整]

**平均时间复杂度**

- 搜索: o(logn)
- 添加:o(logn)，仅需o(1)次调整
- 删除:o(logn),最多需要o(logn)次旋转操作



## 红黑树

### 特点（5大特点）

- **节点是RED或者BLACK**
- **根节点是BLACK**
- **叶子节点(外部节点,空节点) 都是BLACK**
- **RED节点的子节点都是BLACK**
  - RED节点的parent都是BLACK
  - 从根节点到叶子节点的所有路径不能有2个连续的RED节点
- **从任一节点到叶子节点的所有路径都包含相同的BLACK节点**

![image-20201212144943468](https://jameslin23.gitee.io/2020/12/12/平衡二叉搜索树/image-20201212144943468.png)

- 红黑树和4阶B树(2-3-4树)具有等价性
- BLACK节点与它的RED字节点融合在一起，形成1个B树节点
- 红黑树的BLACK节点个树与4阶B树的节点总个树相等

###  添加过程

总共3大类，12种情况

- 4种情况满足红黑情况的性质，不用修改。 **父节点为黑色**

  ![image-20201212151113598](https://jameslin23.gitee.io/2020/12/12/平衡二叉搜索树/image-20201212151113598.png)

- 有八种情况满足红黑树性质：父节点为红色（Double Red）

  ![image-20201212151223612](https://jameslin23.gitee.io/2020/12/12/平衡二叉搜索树/image-20201212151223612.png)

  

- 其中4种叔父(**父节点的兄弟**)节点是黑色

  这4种情况分别是RR/LL/RL/LR

  **RR/LL**

  1、父亲节点染成黑色BLACK,祖父节点染成RED

  2、祖父节点进行单旋

  3、RR(左旋)、LL(右旋)

  ![image-20201212152631233](https://jameslin23.gitee.io/2020/12/12/平衡二叉搜索树/image-20201212152631233.png)

  **RL/LR**

  1、自己染成黑色BLACK,祖父节点染成红色

  2、进行双旋操作

  3、LR(父节点左旋，祖父节点右旋)

  4、RL(父节点右旋，祖父节点左旋)

  ![image-20201212153314487](https://jameslin23.gitee.io/2020/12/12/平衡二叉搜索树/image-20201212153314487.png)

- 4种叔父(**父节点的兄弟**)节点是红色

  这4种情况也分别是RR/LL/RL/LR

  **RR**

  1、父节点和叔父节点染成黑色

  2、祖父节点(染成红色)向上合并，当做新添加节点进行处理

  3、向上合并时候有可能继续发生上益

  ![image-20201212153935525](https://jameslin23.gitee.io/2020/12/12/平衡二叉搜索树/image-20201212153935525.png)

​    



###  删除过程

- A---删除的是叶子节点且该叶子节点是红色的，无需修复。
- B---删除的是叶子节点且叶子节点是黑色的，会破坏特征5，需要修复
- C---删除的节点（P）有一个子节点(S)，通过置换的方式，然后进行删除。
  - S为红，P为黑，对应A情况

待补充（看算法导论为准）

##  AVL树 VS 红黑树

### 总结

**AVL树**

- 平衡标准严格:每个左右子树的高度差不超过1
- 最大高度是1.44*log2(n+1)-1.328(100w节点，AVL树最大树高28)
- 搜索、添加、删除都是o(logn)复杂度，其中添加仅仅需要o(1)次调整、删除最多需要o(logn)次旋转调整

**红黑树**

- 平衡标准比较宽松:没有一条路径会大于其他路径2倍
- 最大高度是2*log2(n+1)(100万个节点，红黑树最大树高40)
- 搜索、添加、删除都是o(logn)复杂度，其中添加、删除都仅仅o(1)次旋转调整

**选择**

- 搜索的次数远远大于插入和删除,选择AVL树；搜索、插入、删除几乎差不多，选择红黑树
- 相对AVL树来说，红黑树牺牲了部分平衡以换取插入/删除操作时少量旋转操作，整体来说性能要优于AVL树
- 红黑树的平均统计性能优于AVL树,实际应用中更多选择使用红黑树













