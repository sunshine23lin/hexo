---
title: spring面向切面
date: 2019-08-24 14:06:36
tags:
categories: Spring
---

### 一、什么是面向切面编程
> 切面模块化横切关注点。简而言之,横切关注点可以被为影响应用多处的功能。安全就是一个横切关注点,应用中许多方法都会涉及到安全规则。
![](sping面向切面/1.png)

1. 定义AOP
描述切面常用术语有通知、切点和连接点。切面是通知和切点的结合。通知和切点共同定义了切面的全部内容,它是什么,在何时和处完成其功能。

- 通知
> 通知定义切面是什么时候以及何时使用。除了描述切面要完成的工作,通知还解决了何时执行这个工作的问题。

Spring切面可以应用5种类型通知:
 - 前置通知:在目标方法被调用之前通知功能
 - 后置通知:在目标方法完成之后通知,此时不会关心方法的输出是什么。
 - 返回通知:在目标方法成功执行之后调用通知
 - 异常通知:在目标方法抛出异常后调用通知
 - 环绕通知:通知包裹了被通知的方法,在被通知的方法调用之前和调用之后执行自定义的行位。

- 连接点
> 连接点是在应用执行过程中能够插入切面的一个点。这个点可以是调用方法时、抛出异常时、甚至修改一个字段时。切面代码可以利用这些点插入到应用的正常流程之中,并添加新的行为。

- 切点
> 一个切面并不需要通知应用的所有连接点。切点有助于缩小切面所通知的连接点的范围。如果通知定义了切面的"什么"和"何时"的话,那么切点定义了"何处"。切点的定义会匹配通知所要织入的一个或多个连接点。通常使用明确的类和方法名称。

- 织入
> 织入是把切面应用到目标对象并创建新的代理对象的过程。切面在指定的连接点被织入到目标对象中，在目标对象的生命周期里有多个点可以进行织入:
 - 编译期:切面在目标类编译时被织入。这方式需要特殊的编译器。AspectJ的织入编译器就是以这种方法织入切面。
 - 类加载期:切面在目标类加载到JVM时被织入。这种方式需要特殊的类加载器。他可以早目标类被引入应用之前增强该目标类的字节码。AspectJ 5的加载时织入溜支持以这种方式织入切面。
 - 运行期：切面在应用运行的某个时刻被织入。一般情况下,在织入切面时,AOP容器会为目标对象动态地创建一个代理对象。SpringAop就是以这种方式织入切面。



2. Spring对AOP的支持
- 基于代理经典的代理Spring AOP
- 纯POJO切面
- @AspectJ注解驱动切面
- 注入式AspectJ切面

### Spring AOP
例子：歌星都有好多助理，歌星最重要的一件事就是唱歌，其他事他不用关注，比如唱歌前可能需要和其他人谈合作，还要布置场地，唱歌后还要收钱等等，这些统统交给他对应的助理去做。也许哪一天，这个歌星做慈善，免费唱歌了，不收钱了，那么就可以把收钱这个助力给辞退了。这就是 AOP，每个人各司其职，灵活组合，达到一种可配置的、可插拔的程序结构。AOP 的实现原理就是代理模式。

> 通过代理,可以详细控制访问某个或者某类对象的方法,在调用这个方法前做前置处理,调用这个方法后后置处理。

